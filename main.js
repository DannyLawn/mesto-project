(()=>{"use strict";var e=document.querySelector(".profile"),t=e.querySelector(".profile__edit-button"),n=e.querySelector(".profile__name"),o=e.querySelector(".profile__activity"),r=e.querySelector(".profile__add-button"),c=e.querySelector(".profile__avatar-container"),a=e.querySelector(".profile__avatar"),u=document.querySelector("#profile-popup"),l=document.forms.editProfile,i=l.elements.profileName,s=l.elements.profileAtivity,d=document.querySelector("#edit-avatar-popup"),p=document.forms.editAvatarForm,f=p.elements.avatarImageLink,m=document.querySelector("#add-card-popup"),_=document.forms.addСardForm,v=_.elements.cardName,y=_.elements.cardImageLink,h=document.querySelector("#open-card"),S=h.querySelector(".popup__image"),b=h.querySelector(".popup__title_type-open-card"),q=document.querySelector("#delete-card-popup"),k=(document.forms.deleteСardForm,document.querySelector(".elements")),L={formSelector:"popup__form",inputSelector:"popup__input-text",submitButtonSelector:"popup__input-submit",inactiveButtonClass:"popup__input-submit_inactive",inputErrorClass:"popup__input-text_type-error",errorClass:"popup__input-error_active"};function E(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function g(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function C(e){document.addEventListener("keydown",T),e.classList.add("popup_opened")}function x(e){document.removeEventListener("keydown",T),e.classList.remove("popup_opened")}function A(e,t){e&&(t.value="Сохранение...")}function T(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function P(e){var t=e.querySelector(".popup__form"),n=Array.from(t.querySelectorAll(".popup__input-text")),o=t.querySelector(".popup__input-submit");n.forEach((function(e){E(t,e,L)})),g(n,o,L)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&x(e),t.target.classList.contains("popup__toggle")&&x(e)}))}));var D,N={url:"https://nomoreparties.co/v1/plus-cohort-13",headers:{"Content-type":"application/json",Authorization:"04094868-01f7-4148-b349-0bbb01e31812"}},B=function(e){return e.ok?e.json():Promise.reject(e)};function w(e){var t=e._id,n=k.querySelector(".card-template").content.querySelector(".elements__element").cloneNode(!0),o=n.querySelector(".elements__image"),r=n.querySelector(".elements__like-count");return o.src=e.link,o.alt=e.name,n.querySelector(".elements__element-title").textContent=e.name,n.querySelector(".elements__like-button").addEventListener("click",(function(e){e.target.classList.contains("elements__like-button_enabled")?function(e){return fetch("".concat(N.url,"/cards/likes/").concat(e),{method:"DELETE",headers:N.headers}).then(B)}(t).then((function(t){e.target.classList.remove("elements__like-button_enabled"),r.textContent=t.likes.length,0===t.likes.length?r.style.display="none":r.style.display="block"})).catch((function(e){return console.log(e.status)})):function(e){return fetch("".concat(N.url,"/cards/likes/").concat(e),{method:"PUT",headers:N.headers}).then(B)}(t).then((function(t){e.target.classList.add("elements__like-button_enabled"),r.textContent=t.likes.length,0===t.likes.length?r.style.display="none":r.style.display="block"})).catch((function(e){return console.log(e.status)}))})),n.querySelector(".elements__delete-button").addEventListener("click",(function(){return function(e,t){q.addEventListener("submit",(function n(o){var r;o.preventDefault(),(r=t,fetch("".concat(N.url,"/cards/").concat(r),{method:"DELETE",headers:N.headers}).then(B)).then((function(){!function(e){e.remove(),e=null}(e),x(q)})).catch((function(e){console.log("При удалении карточки: ".concat(e.status))})),q.removeEventListener("submit",n)})),C(q)}(n,t)})),o.addEventListener("click",(function(){return t=e.link,n=e.name,S.src=t,S.alt=n,b.textContent=n,void C(h);var t,n})),n}function O(e){k.prepend(e)}Promise.all([fetch("".concat(N.url,"/users/me "),{headers:N.headers}).then(B),fetch("".concat(N.url,"/cards"),{headers:N.headers}).then(B)]).then((function(e){var t;t=e[0],n.textContent=t.name,o.textContent=t.about,a.src=t.avatar,function(e){e[1].reverse().forEach((function(t){var n=w(t),o=n.querySelector(".elements__like-count"),r=n.querySelector(".elements__delete-button"),c=n.querySelector(".elements__like-button");0===t.likes.length?o.style.display="none":o.textContent=t.likes.length,t.owner._id!==e[0]._id&&(r.style.display="none"),t.likes.forEach((function(t){t._id===e[0]._id&&c.classList.add("elements__like-button_enabled")})),O(n)}))}(e)})).catch((function(e){console.log("При загрузке данных: ".concat(e.status))})),r.addEventListener("click",(function(){_.reset(),P(m),C(m)})),_.addEventListener("submit",(function(e){e.preventDefault();var t,n=m.querySelector(".popup__input-submit"),o=n.value;A(!0,n),(t={name:v.value,link:y.value},fetch("".concat(N.url,"/cards"),{method:"POST",headers:N.headers,body:JSON.stringify(t)}).then(B)).then((function(e){O(w(e)),x(m),setTimeout((function(){n.value=o}),1e3)})).catch((function(e){console.log("При добавлении карточки: ".concat(e.status))})).finally((function(){A(!1,n)}))})),t.addEventListener("click",(function(){i.value=n.textContent,s.value=o.textContent,P(u),C(u)})),l.addEventListener("submit",(function(e){e.preventDefault();var t,r=u.querySelector(".popup__input-submit"),c=r.value;A(!0,r),(t={name:i.value,about:s.value},fetch("".concat(N.url,"/users/me"),{method:"PATCH",headers:N.headers,body:JSON.stringify(t)}).then(B)).then((function(e){n.textContent=e.name,o.textContent=e.about,x(u),setTimeout((function(){r.value=c}),1e3)})).catch((function(e){console.log("При сохранении профиля: ".concat(e.status))})).finally((function(){A(!1,r)}))})),c.addEventListener("click",(function(){p.reset(),P(d),C(d)})),p.addEventListener("submit",(function(e){e.preventDefault();var t,n=d.querySelector(".popup__input-submit"),o=n.value;A(!0,n),(t={avatar:f.value},fetch("".concat(N.url,"/users/me/avatar"),{method:"PATCH",headers:N.headers,body:JSON.stringify(t)}).then(B)).then((function(e){a.src=e.avatar,x(d),setTimeout((function(){n.value=o}),1e3)})).catch((function(e){console.log("При обновлении аватарки: ".concat(e.status))})).finally((function(){A(!1,n)}))})),D=L,Array.from(document.querySelectorAll(".".concat(D.formSelector))).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputSelector))),o=e.querySelector(".".concat(t.submitButtonSelector));g(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?E(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),g(n,o,t)}))}))}(e,D)}))})();