(()=>{"use strict";var e=document.querySelector(".profile"),t=e.querySelector(".profile__edit-button"),n=e.querySelector(".profile__name"),o=e.querySelector(".profile__activity"),r=e.querySelector(".profile__add-button"),c=e.querySelector(".profile__avatar-container"),a=e.querySelector(".profile__avatar"),u=document.querySelector("#profile-popup"),i=document.forms.editProfile,l=i.elements.profileName,s=i.elements.profileAtivity,d=document.querySelector("#edit-avatar-popup"),f=document.forms.editAvatarForm,p=f.elements.avatarImageLink,m=document.querySelector("#add-card-popup"),_=document.forms.addСardForm,y=_.elements.cardName,v=_.elements.cardImageLink,h=document.querySelector("#open-card"),S=h.querySelector(".popup__image"),b=h.querySelector(".popup__title_type-open-card"),q=document.querySelector("#delete-card-popup"),k=(document.forms.deleteСardForm,document.querySelector(".elements")),L="popup__form",g="popup__input-text",E="popup__input-submit",C="popup__input-submit_inactive",x="popup__input-text_type-error",A="popup__input-error_active";function T(e,t,n,o){var r=e._id,c=k.querySelector(".card-template").content.querySelector(".elements__element").cloneNode(!0),a=c.querySelector(".elements__image"),u=c.querySelector(".elements__like-count");return a.src=e.link,a.alt=e.name,c.querySelector(".elements__element-title").textContent=e.name,c.querySelector(".elements__like-button").addEventListener("click",(function(e){return o(r,u,e)})),c.querySelector(".elements__delete-button").addEventListener("click",(function(){return n(c,r)})),a.addEventListener("click",(function(){return t(e.link,e.name)})),c}function P(e){document.addEventListener("keydown",w),e.classList.add("popup_opened")}function D(e){document.removeEventListener("keydown",w),e.classList.remove("popup_opened")}function N(e,t){e.querySelector(".popup__input-submit").value=t}function w(e){"Escape"===e.key&&D(document.querySelector(".popup_opened"))}function O(e){var t=e.querySelector(".".concat(L)),n=Array.from(t.querySelectorAll(".".concat(g))),o=t.querySelector(".".concat(E));n.forEach((function(e){j(t,e)})),F(n,o)}function j(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(x),n.textContent="",n.classList.remove(A)}function F(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(C),t.disabled=!1):(t.classList.add(C),t.disabled=!0)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&D(e),t.target.classList.contains("popup__toggle")&&D(e)}))}));var J={url:"https://nomoreparties.co/v1/plus-cohort-13",headers:{"Content-type":"application/json",Authorization:"04094868-01f7-4148-b349-0bbb01e31812"}},H=function(e){return e.ok?e.json():Promise.reject(e)};function I(e,t){S.src=e,S.alt=t,b.textContent=t,P(h)}function z(e,t){q.addEventListener("submit",(function n(o){var r;o.preventDefault(),(r=t,fetch("".concat(J.url,"/cards/").concat(r),{method:"DELETE",headers:J.headers}).then(H)).then((function(){e.remove(),D(q)})).catch((function(e){console.log("При удалении карточки: ".concat(e.status))})),q.removeEventListener("submit",n)})),P(q)}function M(e,t,n){n.target.classList.contains("elements__like-button_enabled")?function(e){return fetch("".concat(J.url,"/cards/likes/").concat(e),{method:"DELETE",headers:J.headers}).then(H)}(e).then((function(e){!function(e,t,n){n.target.classList.remove("elements__like-button_enabled"),t.textContent=e.likes.length,0===e.likes.length?t.style.display="none":t.style.display="block"}(e,t,n)})).catch((function(e){return console.log(e.status)})):function(e){return fetch("".concat(J.url,"/cards/likes/").concat(e),{method:"PUT",headers:J.headers}).then(H)}(e).then((function(e){!function(e,t,n){n.target.classList.add("elements__like-button_enabled"),t.textContent=e.likes.length,0===e.likes.length?t.style.display="none":t.style.display="block"}(e,t,n)})).catch((function(e){return console.log(e.status)}))}function U(e){k.prepend(e)}Promise.all([fetch("".concat(J.url,"/users/me "),{headers:J.headers}).then(H),fetch("".concat(J.url,"/cards"),{headers:J.headers}).then(H)]).then((function(e){var t,r=e[0]._id;t=e[0],n.textContent=t.name,o.textContent=t.about,a.src=t.avatar,function(e,t){e.reverse().forEach((function(e){var n=T(e,I,z,M);!function(e,t,n){var o=n.querySelector(".elements__like-count"),r=n.querySelector(".elements__delete-button"),c=n.querySelector(".elements__like-button");0===e.likes.length?o.style.display="none":o.textContent=e.likes.length,e.owner._id!==t&&(r.style.display="none"),e.likes.forEach((function(e){e._id===t&&c.classList.add("elements__like-button_enabled")}))}(e,t,n),U(n)}))}(e[1],r)})).catch((function(e){console.log("При загрузке данных: ".concat(e.status))})),r.addEventListener("click",(function(){_.reset(),O(m),P(m)})),_.addEventListener("submit",(function(e){var t;e.preventDefault(),N(m,"Сохранение..."),(t={name:y.value,link:v.value},fetch("".concat(J.url,"/cards"),{method:"POST",headers:J.headers,body:JSON.stringify(t)}).then(H)).then((function(e){U(T(e,I,z,M)),D(m)})).catch((function(e){console.log("При добавлении карточки: ".concat(e.status))})).finally((function(){setTimeout((function(){N(m,"Создать")}),1e3)}))})),t.addEventListener("click",(function(){l.value=n.textContent,s.value=o.textContent,O(u),P(u)})),i.addEventListener("submit",(function(e){var t;e.preventDefault(),N(u,"Сохранение..."),(t={name:l.value,about:s.value},fetch("".concat(J.url,"/users/me"),{method:"PATCH",headers:J.headers,body:JSON.stringify(t)}).then(H)).then((function(e){n.textContent=e.name,o.textContent=e.about,D(u)})).catch((function(e){console.log("При сохранении профиля: ".concat(e.status))})).finally((function(){setTimeout((function(){N(u,"Сохранить")}),1e3)}))})),c.addEventListener("click",(function(){f.reset(),O(d),P(d)})),f.addEventListener("submit",(function(e){var t;e.preventDefault(),N(d,"Сохранение..."),(t={avatar:p.value},fetch("".concat(J.url,"/users/me/avatar"),{method:"PATCH",headers:J.headers,body:JSON.stringify(t)}).then(H)).then((function(e){a.src=e.avatar,D(d)})).catch((function(e){console.log("При обновлении аватарки: ".concat(e.status))})).finally((function(){setTimeout((function(){N(d,"Сохранить")}),1e3)}))})),Array.from(document.querySelectorAll(".".concat(L))).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".".concat(g))),n=e.querySelector(".".concat(E));F(t,n),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.valid?j(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(x),o.textContent=n,o.classList.add(A)}(e,t,t.validationMessage)})(e,o),F(t,n)}))}))}(e)}))})();